;M.add("w-slider",function(e){var t=e.Lang.isFunction,i=e.UA,n=e.mt.util,r={triggerContainer:"mt-slider-trigger-container",triggerContainerEx:"mt-slider-trigger-container-ex",trigger:"mt-slider-trigger",currentTrigger:"mt-slider-current-trigger",sheetContainer:"mt-slider-sheet-container",sheet:"mt-slider-sheet",currentSheet:"mt-slider-current-sheet",previous:"mt-slider-previous",next:"mt-slider-next"},s=e.config["w-slider"]||{},a=function(){a.superclass.constructor.apply(this,arguments)};a.NAME="Slider",a.CSS_PREFIX="mt-slider",a.HTML_PARSER={sheetContainer:"> ."+r.sheetContainer,triggerContainer:"> ."+r.triggerContainer,triggerContainerEx:"> ."+r.triggerContainerEx,previous:"> .previous",next:"> .next"},a.TEMPLATE={trigger:'<a href="javascript:;" hidefocus="true" class="{previous}"></a><a href="javascript:;" hidefocus="true" class="{next}"></a>',statusBar:"<ul></ul>"},a.CLASS_NAME=r,a.ATTRS={sheetContainer:{value:null,setter:function(t){return e.one(t)}},triggerContainerEx:{value:null,setter:function(t){return e.one(t)}},triggerContainer:{value:null,setter:function(t){return e.one(t)}},pnContainer:{value:null,setter:function(t){return e.one(t)}},previous:{value:null,setter:function(t){return e.one(t)}},next:{value:null,setter:function(t){return e.one(t)}},autoPlay:{value:!0},activeStop:{value:!0},pnAutoHide:{value:!1},interval:{value:5e3},effect:{value:"slideLeft"},duration:{value:300},triggerEvent:{value:"click"},index:{value:0},hoverOpacity:{value:i.ie<=8&&i.ie>0?1:.6},lazyloading:{value:!1}},e.extend(a,e.Widget,{initializer:function(){var e=this,t=e.get("sheetContainer"),i=t&&t.all("> li");if(i&&i.isEmpty())throw new Error(a.NAME+": 没有内容页");e._timer=null,e._handles={},e._pause=!1,e._nlSheet=i},destructor:function(){n.detachHandle(this._handles),this.get("boundingBox").remove(!0)},_beforeRenderUI:function(){var e=this.get("index"),t=this._nlSheet,i=t.item(e);this._updateImgs(i),i.show(),"slideFadeIn"===this.get("effect")&&(t.setStyle("opacity",0),i.setStyle("opacity",1))},_afterRenderUI:function(){var e=this._nlSheet,t=(this.get("index")+1)%e.size();this._updateImgs(e.item(t))},_updateImgs:function(e){this.get("lazyloading")&&e.all("img[data-src]").each(function(e){s.cssLazyClass&&e.on("load",function(){e.removeClass(s.cssLazyClass)}),e.set("src",e.getAttribute("data-src")),e.removeAttribute("data-src")})},renderUI:function(){this._beforeRenderUI(),this._renderTriggerContainer(),this._modifySheetContainer(),this._renderPreNextContainer(),this._anim=this._getAnim(),this._afterRenderUI()},_renderTriggerContainer:function(){var e=this.get("triggerContainer"),t=this.get("triggerContainerEx"),i=this._nlSheet,n=this.get("index"),s=0,a=null;e?(s=e.all("> li").size(),i.size()!==s&&e.setHTML(function(){for(var e=[],t=0;t<i.size();t++)e.push("<li></li>");return e.join("")}()),"none"===e.getStyle("display")&&e.show(),a=e.all("> li"),a.addClass(r.trigger),a.item(n).addClass(r.currentTrigger),e.addClass(r.triggerContainer)):t&&(t.one(".total").setHTML(i.size()),t.one(".current").setHTML(1),"none"===t.getStyle("display")&&t.show())},_modifySheetContainer:function(){var e=this.get("sheetContainer"),t=this._nlSheet,i=this.get("index");e.addClass(r.sheetContainer),t.addClass(r.sheet),t.item(i).addClass(r.currentSheet),t.each(function(e,t){t!==i&&e.hide()})},_renderPreNextContainer:function(){var e=this.get("previous"),t=this.get("pnAutoHide"),i=this.get("next");i||e?t&&(e&&(e.setStyle("opacity",0),e.show()),i&&(i.setStyle("opacity",0),i.show())):this.buildPreNext()},buildPreNext:function(){var t,i,n,s=this.get("pnContainer"),o=this.get("pnAutoHide");s&&(n=e.Node.create(e.Lang.sub(a.TEMPLATE.trigger,r)),s.append(n),this.set("previous",t=s.one("."+r.previous)),this.set("next",i=s.one("."+r.next)),o&&(t.setStyle("opacity",0),i.setStyle("opacity",0)))},bindUI:function(){var e=this,t=e.get("triggerContainer"),i=e.get("sheetContainer"),n=this.get("pnAutoHide"),r=t&&t.all("> li");e.isFromNavigator=!1,e.after("indexChange",this._defIndexChangeFn,this),i.on({mouseover:function(){e.pause()},mouseout:function(){e.reset()}}),r&&r.each(function(t,i){t.on(e.get("triggerEvent"),function(t){t.halt(),e.set("index",i),e._activeStop=!0,e.reset()})}),this.lrBtnClickHandler(),n&&this.handleLrBtnHide()},syncUI:function(){this.get("autoPlay")&&this.play()},lrBtnClickHandler:function(){var e=this.get("previous"),t=this.get("next"),i=this;e&&e.on("click",function(e){e.halt(),i.showPrevious(),i._activeStop=!0,i.reset()}),t&&t.on("click",function(e){e.halt(),i.showNext(),i._activeStop=!0,i.reset()})},handleLrBtnHide:function(){function e(){s.setStyle("opacity",l),a.setStyle("opacity",l)}function t(e){e.pageX>n.left&&e.pageX<n.left+n.width&&e.pageY>n.top&&e.pageY<n.top+n.height||(s.setStyle("opacity",0),a.setStyle("opacity",0))}var i,n,r,s=this.get("previous"),a=this.get("next"),o=this,l=this.get("hoverOpacity");a&&s&&(r={mouseover:e,mouseout:t},i=o.get("sheetContainer"),n=i.get("region"),i.delegate(r,".mt-slider-sheet"),a.on(r),s.on(r))},_defIndexChangeFn:function(e){var t=this,i=t.get("triggerContainer"),n=t.get("triggerContainerEx"),s=i&&i.all("> li"),a=t._nlSheet,o=a.size(),l=e.prevVal,u=e.newVal;s&&e.newVal>=s.size()||(t._updateImgs(a.item(e.newVal)),s&&(s.item(l).removeClass(r.currentTrigger),s.item(u).addClass(r.currentTrigger)),n&&n.one(".current").setHTML(u+1),t.isFromNavigator||(2===o?t._dir=!0:Math.abs(u-l)===o-1?t._dir=u<l:t._dir=u>l),t._anim(a.item(l),a.item(u)))},_getAnim:function(){var i,n,r,s,o,l,u=this,g=u.get("sheetContainer"),d=u.get("effect"),h=u.get("duration")/1e3,c=null,f=null,p=null,v=!0;switch(d){case"slideHorizontal":case"slideLeft":i=parseInt(g.getStyle("width"),10),n={left:i},o={left:-i},l={left:0},f={nextStyles:{left:i},currentAnimTo:{left:-i}},p={nextStyles:{left:-i},currentAnimTo:{left:i}};break;case"slideVertical":case"slideUp":i=parseInt(g.getStyle("height"),10),n={top:i},o={top:-i},l={top:0},f={nextStyles:{top:i},currentAnimTo:{top:-i}},p={nextStyles:{top:-i},currentAnimTo:{top:i}};break;case"slideFadeIn":o={opacity:0},l={opacity:1};break;default:throw new Error(a.NAME+": 切换效果类型不存在")}return r=new e.Anim({from:{},to:o||{},duration:h,easing:e.Easing.easeBoth}),s=new e.Anim({from:{},to:l||{},duration:h,easing:e.Easing.easeBoth}),c=p||null,function(e,i,a){c&&u._dir!==v&&(v=u._dir,n=c.nextStyles,r.set("to",c.currentAnimTo),c=c===f?p:f),u.isFromNavigator=!1,r.stop(!0),s.stop(!0),n&&i.setStyles(n),i.show(),r.set("node",e),r.detach("end"),r.on("end",function(){e.hide()}),s.set("node",i),s.detach("end"),s.on("end",function(){t(a)&&a(),u.fire("endAnim",{index:u.get("index")})}),r.run(),s.run()}},showPrevious:function(){var e=this,t=e.get("index"),i=e._nlSheet.size(),n=0===t?i-1:(t-1)%i;e.isFromNavigator=!0,e._dir=!1,e.set("index",n)},showNext:function(){var e=this,t=e.get("index"),i=e._nlSheet.size(),n=(t+2)%i,r=(t+1)%i;e.isFromNavigator=!0,e._dir=!0,e.set("index",r),e._updateImgs(this._nlSheet.item(n))},pause:function(){this._pause=!0},reset:function(){var e=this;if(e._pause=!1,e.get("autoPlay")){if(window.clearTimeout(e._timer),e.get("activeStop")&&e._activeStop)return;e.play()}},isPause:function(){return this._pause},play:function(){var e=this;e._timer=window.setTimeout(function(){e.isPause()||(e.showNext(),e.play())},e.get("interval"))}}),e.mt.widget.Slider=a},"1.0.0",{requires:["mt-base","anim","widget","node"],skinnable:!0});
